---
title: "Covid19 vaccine study Fall2021"
author: "Put your name here!"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 5

---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
TheData <-read.csv(file="fall21.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- TheData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>% mutate(across(where(is.character),as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
guy = filter(FinalData, sex =="guy")
gal = filter(FinalData, sex =="gal")
gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```


# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups consisting of Males, Females, just the drug users, and just those in the LGBTQ community. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Part of the information you need to compute is the so-called effectiveness of the drug for each subgroup of people. Include a 95% confidence interval of the effectiveness for each different subgroup. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Males


### Barplot



```{r}
TheData <- guy %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))

# the group_by followed by summarize(count=n())
basicC <- ggplot(TheData,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot
basicCC <- ggplot(TheData,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=guy)
rowPerc(table1)
colPerc(table1)
```


### Inferential 



```{r}
chisq.test(table1)
chisqtestGC(table1)
guyfish <- fisher.test(table1)
guyfish
```


```{r}
effect <- guyfish$p.value/(guyfish$p.value +1)
effectivenessguy = guyfish$estimate/(guyfish$estimate +1)*100
print(effectivenessguy)
```

## Effectiveness for guy is `r round(effectivenessguy,0)`


```{r}
low=(guyfish$conf.int[1]/(guyfish$conf.int[1] +1))*100
hi=(guyfish$conf.int[2]/(guyfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`




# GALS

```{r}
TheData <- gal %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())
basicC <- ggplot(TheData,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(TheData,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```



### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=gal)
rowPerc(table1)
colPerc(table1)
```

### Inferential 



```{r}
chisq.test(table1)
chisqtestGC(table1)
galfish <- fisher.test(table1)
galfish
```


```{r}
effect <- galfish$p.value/(galfish$p.value +1)
effectivenessgal = galfish$estimate/(galfish$estimate +1)*100
print(effectivenessgal)
```

## Effectiveness for GAl is `r round(effectivenessgal,0)`


```{r}
low=(galfish$conf.int[1]/(galfish$conf.int[1] +1))*100
hi=(galfish$conf.int[2]/(galfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`




# Drug Users


```{r}
TheData <- DrugUser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())
basicC <- ggplot(TheData,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(TheData,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=DrugUser)
rowPerc(table1)
colPerc(table1)
```

### Inferential 



```{r}
chisq.test(table1)
chisqtestGC(table1)
DrugUserfish <- fisher.test(table1)
DrugUserfish
```



```{r}
effect <- DrugUserfish$p.value/(DrugUserfish$p.value +1)
effectivenessDrugUser = DrugUserfish$estimate/(DrugUserfish$estimate +1)*100
print(effectivenessDrugUser)
```

## Effectiveness for DrugUser is `r round(effectivenessguy,0)`


```{r}
low=(DrugUserfish$conf.int[1]/(DrugUserfish$conf.int[1] +1))*100
hi=(DrugUserfish$conf.int[2]/(DrugUserfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

# LGBTQ





# Conclusions and recommendations

